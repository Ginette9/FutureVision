@tailwind base;
@tailwind components;
@tailwind utilities;

/* 强制重置封面和封底的所有可能影响 */
[data-print-page="cover"], [data-print-page="back"] {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  outline: 0 !important;
  box-sizing: border-box !important;
  position: relative !important;
  display: block !important;
}

[data-print-page="cover"] *, [data-print-page="back"] * {
  box-sizing: border-box !important;
}

/* 确保html和body在所有情况下都没有默认边距 */
html, body {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  box-sizing: border-box !important;
}

/* 强制重置根元素和第一个子元素 */
#root {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
}

#root > * {
  margin: 0 !important;
  padding: 0 !important;
}

/* 打印模式下强制重置第一个元素 */
@media print {
  #root, #root > * {
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
  }
  
  /* 只重置非打印页面的深层元素 */
  #root > *:not(.print-page) > * {
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
  }
  
  /* 确保第一个打印页面没有上边距 */
  .print-only:first-child,
  .print-page:first-child {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
}

/* —— 基础主题 —— */
:root{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
  line-height:1.5; font-weight:400;
  font-synthesis:none; text-rendering:optimizeLegibility;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* —— 基础排版 —— */
@layer base{
  .prose p,.prose ul,.prose ol{ margin:1rem 0; line-height:1.5; }

  @media print{
    .no-print-only{ display:none!important; }
    .print-only{ display:block!important; }

    /* 内页边距 */
    @page{ size:A4 portrait; }
    @page cover{ size:A4 portrait; margin:0; }
    @page back{  size:A4 portrait; margin:0; }

    html,body{
      background:transparent!important;
      -webkit-print-color-adjust:exact; print-color-adjust:exact;
      margin:0!important; padding:0!important; border:0!important;
    }
    
    /* 封面和封底页面需要透明背景 - 使用更兼容的方法 */
    [data-print-page="cover"] ~ *,
    [data-print-page="back"] ~ * {
      background: transparent !important;
    }
    
    /* 直接针对封面封底容器的父元素 */
    .print-only[data-print-page="cover"],
    .print-only[data-print-page="back"] {
      background: transparent !important;
    }
  }
}

/* —— 屏幕 & 打印通用卡片 —— */
.pdf-card{ border:1px solid rgba(0,0,0,.06); background:#fff; }
.pdf-card__logo img.pdf-logo{ max-height:96px; width:auto; }
.pdf-card__body .prose p{ margin:.5rem 0; }

@media print{
  [data-print-page="cover"]{ page:cover; }
  [data-print-page="back"]{  page:back;  }
  [data-print-page="cover"],[data-print-page="back"]{ break-inside:avoid; page-break-inside:avoid; }

  .pdf-card{ page-break-inside:avoid; break-inside:avoid; border-color:rgba(0,0,0,.1); }
  .pdf-card__logo img.pdf-logo{ max-height:80px; }
  .pdf-card__body .prose{ font-size:13px; line-height:1.5; }
}


/* ===================================================== */
/*        打印专用「封面 / 尾页」容器基础                   */
/* ===================================================== */

.print-only{ display:none; }

/* —— 打印模式专用样式 —— */
@media print{
  @page {
    size: A4;
    margin: 20mm 12mm;
  }
  
  @page cover {
    margin: 0 !important;
    padding: 0 !important;
    size: A4;
  }
  
  @page back {
    margin: 0 !important;
    padding: 0 !important;
    size: A4;
  }
  
  html, body {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: 100% !important;
  }
  
  .print-page{
    break-inside:avoid; page-break-inside:avoid; page-break-after:always;
    padding:0!important; box-sizing:border-box; background:transparent;
    width:210mm!important;
    min-height:297mm;
    display:block!important; position:relative; margin:0 auto!important;
  }
}

/* —— 浏览器预览模式专用样式 —— */
@media screen {
  .print-page {
    padding: 20mm 12mm !important;
    box-sizing: border-box;
    margin: 0 auto;
    max-width: 210mm;
    min-height: calc(297mm - 40mm);
    background: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }

  /* 浏览器预览模式下隐藏封面和尾页 */
  .print-page[data-print-page="cover"],
  .print-page[data-print-page="back"] {
    display: none !important;
  }
}

/* —— 通用封面和封底样式 —— */
.print-page[data-print-page="cover"],
.print-page[data-print-page="back"]{
  position:relative!important; overflow:hidden!important; isolation:isolate;
  background:transparent!important; box-sizing:border-box!important;
  z-index:0;
}

/* 背景层（图片）隐藏 */
[data-print-page="cover"].print-page::before,
[data-print-page="back"].print-page::before,
[data-print-page="cover"].print-page::after,
[data-print-page="back"].print-page::after{
  display: none !important;
}

/* 内容层样式 */
.cover-page,.back-page{ 
  position:relative!important; 
  z-index:0!important; 
  display:flex!important; 
  flex-direction:column; 
  align-items:center; 
  justify-content:center;
  padding:0; 
  box-sizing:border-box; 
  color:#fff; 
  text-align:center;
}

/* 打印模式下封面和封底尺寸 */
@media print {
  .cover-page,.back-page{ 
    width:100%!important; 
    height:100vh!important;
  }
}

/* 浏览器预览模式下封面和封底尺寸 */
@media screen {
  .cover-page,.back-page{ 
    width:210mm!important; 
    height:297mm!important;
  }
}

/* ---------- html2pdf 导出：镜像打印规则 ---------- */
html.export-pdf{
  font-size:13px!important; -webkit-print-color-adjust:exact; print-color-adjust:exact; background:transparent!important;
}

/* 导出模式下封面和封底需要透明背景 - 使用更兼容的方法 */
html.export-pdf .print-only[data-print-page="cover"],
html.export-pdf .print-only[data-print-page="back"] {
  background: transparent !important;
}
html.export-pdf .print-only{ display:block!important; }
html.export-pdf .no-print-only{ display:none!important; }

html.export-pdf .print-page{
  break-inside:avoid; page-break-inside:avoid; page-break-after:always;
  padding:12mm; box-sizing:border-box; background:transparent; width:210mm!important;
  min-height:calc(297mm - 12mm - 12mm - 12mm - 12mm);
}

/* 导出模式下封面和封底页面透明背景 */
html.export-pdf [data-print-page="cover"].print-page,
html.export-pdf [data-print-page="back"].print-page {
  background: transparent !important;
  display:block!important; position:relative; margin:0 auto!important;
  padding:0!important;
  min-height:297mm!important;
  height:297mm!important;
}
html.export-pdf .print-page[data-print-page="cover"],
html.export-pdf .print-page[data-print-page="back"]{
  padding:0!important; margin:0!important; border:0!important;
  width:100%!important; height:297mm!important; min-height:297mm!important;
  position:relative!important; overflow:hidden!important; isolation:isolate;
  background:transparent!important; box-sizing:border-box!important; z-index:0;
  top:0!important; left:0!important;
}
html.export-pdf [data-print-page="cover"].print-page::before,
html.export-pdf [data-print-page="back"].print-page::before{
  display: none !important;
}
/* 移除蒙版以确保PNG图片完整显示 */
html.export-pdf [data-print-page="cover"].print-page::after,
html.export-pdf [data-print-page="back"].print-page::after{
  display: none !important;
}
html.export-pdf .cover-page, html.export-pdf .back-page{ position:relative!important; z-index:0!important; }

/* —— 导出下的排版镜像 —— */
html.export-pdf .cover-page{
  display:grid!important; grid-template-rows:auto 1fr auto;
  padding:0mm; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
}
html.export-pdf .back-page{
  display:flex!important; flex-direction:column; align-items:center; justify-content:center;
  padding:0mm; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
}

/* ========================= */
/*           其他            */
/* ========================= */

@media print{
  html.print-mode{ font-size:13px!important; }
  html.print-mode *{ transform:none!important; animation:none!important; transition:none!important; box-shadow:none!important; filter:none!important; }
  html.print-mode .fixed,html.print-mode .sticky{ position:static!important; top:auto!important; inset:auto!important; }
  html.print-mode img,html.print-mode video,html.print-mode svg{ max-width:100%!important; height:auto!important; }
  html.print-mode table{ border-collapse:collapse!important; width:100%!important; }
  html.print-mode th,html.print-mode td{ page-break-inside:avoid!important; break-inside:avoid!important; }
  html.print-mode h1{ font-size:1.6rem!important; line-height:1.25!important; letter-spacing:.2px!important; }
  html.print-mode h2{ font-size:1.25rem!important; line-height:1.3!important; }
  html.print-mode h3{ font-size:1.05rem!important; line-height:1.35!important; }
  html.print-mode .prose :where(h1){ font-size:1.45rem!important; }
  html.print-mode .prose :where(h2){ font-size:1.2rem!important; }
  html.print-mode .prose :where(h3){ font-size:1.05rem!important; }
  html.print-mode a{ text-decoration:underline!important; color:#000!important; }
  .pdf-break-before{ page-break-before:always!important; }
  .pdf-break-after{ page-break-after:always!important; }
}

html.export-pdf *{ transform:none!important; animation:none!important; transition:none!important; box-shadow:none!important; filter:none!important; }
html.export-pdf .fixed,html.export-pdf .sticky{ position:static!important; top:auto!important; inset:auto!important; }
html.export-pdf img,html.export-pdf video,html.export-pdf svg{ max-width:100%!important; height:auto!important; }
html.export-pdf table{ border-collapse:collapse!important; width:100%!important; }
html.export-pdf th,html.export-pdf td{ page-break-inside:avoid!important; break-inside:avoid!important; }
html.export-pdf .prose :where(h1){ font-size:1.45rem!important; }
html.export-pdf .prose :where(h2){ font-size:1.2rem!important; }
html.export-pdf .prose :where(h3){ font-size:1.05rem!important; }
.exporting .no-print-only{ display:none!important; }
