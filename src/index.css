@tailwind base;
@tailwind components;
@tailwind utilities;

/* 强制重置封面和封底的所有可能影响 */
[data-print-page="cover"], [data-print-page="back"] {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  outline: 0 !important;
  box-sizing: border-box !important;
  position: relative !important;
  display: block !important;
}

[data-print-page="cover"] *, [data-print-page="back"] * {
  box-sizing: border-box !important;
}

/* 确保html和body在所有情况下都没有默认边距 */
html, body {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
  box-sizing: border-box !important;
}

/* 强制重置根元素和第一个子元素 */
#root {
  margin: 0 !important;
  padding: 0 !important;
  border: 0 !important;
}

#root > * {
  margin: 0 !important;
  padding: 0 !important;
}

/* 打印模式下强制重置第一个元素 */
@media print {
  #root, #root > * {
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
  }
  
  /* 只重置非打印页面的深层元素 */
  #root > *:not(.print-page) > * {
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
  }
  
  /* 确保第一个打印页面没有上边距 */
  .print-only:first-child,
  .print-page:first-child {
    margin-top: 0 !important;
    padding-top: 0 !important;
  }
}

/* —— 基础主题 —— */
:root{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
  line-height:1.5; font-weight:400;
  font-synthesis:none; text-rendering:optimizeLegibility;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* —— 基础排版 —— */
@layer base{
  .prose p,.prose ul,.prose ol{ margin:1rem 0; line-height:1.5; }

  @media print{
    .no-print{ display:none!important; }
    .no-print-only{ display:none!important; }
    .print-only{ display:block!important; }
    
    /* 在打印时隐藏屏幕显示的内容 */
    .screen-only{ display:none!important; }
    
    /* 优化PDF中卡片的打印样式 */
    .bg-gradient-to-br {
      background: linear-gradient(to bottom right, var(--tw-gradient-from), var(--tw-gradient-to)) !important;
    }
    
    .shadow-sm {
      box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05) !important;
    }
    
    .hover\:shadow-md:hover {
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06) !important;
    }
    
    .rounded-xl {
      border-radius: 0.75rem !important;
    }
    
    /* 确保渐变背景在PDF中正确显示 */
    .from-red-50 {
      --tw-gradient-from: #fef2f2 !important;
    }
    
    .to-red-100 {
      --tw-gradient-to: #fee2e2 !important;
    }
    
    .from-green-50 {
      --tw-gradient-from: #f0fdf4 !important;
    }
    
    .to-green-100 {
      --tw-gradient-to: #dcfce7 !important;
    }

    /* 内页边距 */
    @page{ size:A4 portrait; }
    @page cover{ size:A4 portrait; margin:0; }
    @page back{  size:A4 portrait; margin:0; }

    html,body{
      background:transparent!important;
      -webkit-print-color-adjust:exact; print-color-adjust:exact;
      margin:0!important; padding:0!important; border:0!important;
    }
    
    /* 封面和封底页面需要透明背景 - 使用更兼容的方法 */
    [data-print-page="cover"] ~ *,
    [data-print-page="back"] ~ * {
      background: transparent !important;
    }
    
    /* 直接针对封面封底容器的父元素 */
    .print-only[data-print-page="cover"],
    .print-only[data-print-page="back"] {
      background: transparent !important;
    }
  }
}

/* —— 屏幕 & 打印通用卡片 —— */
.pdf-card{ border:1px solid rgba(0,0,0,.06); background:#fff; }
.pdf-card__logo img.pdf-logo{ max-height:96px; width:auto; }
.pdf-card__body .prose p{ margin:.5rem 0; }

@media print{
  [data-print-page="cover"]{ page:cover; }
  [data-print-page="back"]{  page:back;  }
  [data-print-page="cover"],[data-print-page="back"]{ break-inside:avoid; page-break-inside:avoid; }

  .pdf-card{ page-break-inside:avoid; break-inside:avoid; border-color:rgba(0,0,0,.1); }
  .pdf-card__logo img.pdf-logo{ max-height:80px; }
  .pdf-card__body .prose{ font-size:13px; line-height:1.5; }
  
  /* 优化分页控制 */
  .break-after-avoid{ page-break-after:avoid; break-after:avoid; }
  .break-inside-avoid-page{ page-break-inside:avoid; break-inside:avoid-page; }
  .page-break-after-avoid{ page-break-after:avoid; break-after:avoid; }
  .page-break-inside-avoid{ page-break-inside:avoid; break-inside:avoid; }
  
  /* 允许合理的分页 */
  .space-y-2 > *:not(:first-child){ page-break-before:auto; }
  .space-y-3 > *:not(:first-child){ page-break-before:auto; }
  .space-y-4 > *:not(:first-child){ page-break-before:auto; }
  .space-y-6 > *:not(:first-child){ page-break-before:auto; }
  .space-y-8 > *:not(:first-child){ page-break-before:auto; }
  
  /* 各个打印页面的特定样式 */
  .print-intro-section {
    background: white !important;
  }
  
  .print-risk-section {
    background: white !important;
  }
  
  .print-other-sections {
    background: white !important;
  }
  
  .print-other-sections .space-y-8 > section {
    margin-bottom: 20px !important;
    page-break-inside: avoid !important;
  }
}


/* ===================================================== */
/*        打印专用「封面 / 尾页」容器基础                   */
/* ===================================================== */

.print-only{ display:none; }

/* —— 打印模式专用样式 —— */
@media print{
  @page {
    size: A4;
    margin: 15mm 12mm;
  }
  
  @page cover {
    margin: 0 !important;
    padding: 0 !important;
    size: A4;
  }
  
  @page back {
    margin: 0 !important;
    padding: 0 !important;
    size: A4;
  }
  
  html, body {
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: 100% !important;
  }
  
  .print-page{
    page-break-after:always; break-after:page;
    padding:0!important; box-sizing:border-box; background:white;
    width:210mm!important;
    min-height:267mm; /* A4高度减去页边距 */
    display:block!important; position:relative; margin:0 auto!important;
  }
  
  /* 最后一页不强制分页 */
  .print-page:last-child{
    page-break-after:auto; break-after:auto;
  }
  
  /* 优化打印版本的风险分析部分 */
  .print-risk-analysis {
    font-size: 12px !important;
    line-height: 1.4 !important;
  }
  
  .print-risk-analysis h2 {
    font-size: 16px !important;
    font-weight: 700 !important;
    color: #1e40af !important;
    margin-bottom: 8px !important;
    page-break-after: avoid !important;
  }
  
  .print-risk-analysis h3 {
    font-size: 14px !important;
    font-weight: 600 !important;
    color: #374151 !important;
    margin-bottom: 6px !important;
    page-break-after: avoid !important;
  }
  
  .print-risk-analysis .risk-item {
    border: 1px solid #e5e7eb !important;
    border-radius: 4px !important;
    padding: 8px !important;
    margin-bottom: 6px !important;
    page-break-inside: avoid !important;
    background: #f9fafb !important;
  }
  
  .print-risk-analysis .recommendation-item {
    border: 1px solid #dbeafe !important;
    border-radius: 4px !important;
    padding: 8px !important;
    margin-bottom: 6px !important;
    page-break-inside: avoid !important;
    background: #eff6ff !important;
  }
}

/* —— 浏览器预览模式专用样式 —— */
@media screen {
  .print-page {
    padding: 20mm 12mm !important;
    box-sizing: border-box;
    margin: 0 auto;
    max-width: 210mm;
    min-height: calc(297mm - 40mm);
    background: white;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
    margin-bottom: 20px;
  }

  /* 浏览器预览模式下隐藏封面和尾页 */
  .print-page[data-print-page="cover"],
  .print-page[data-print-page="back"] {
    display: none !important;
  }
}

/* —— 通用封面和封底样式 —— */
.print-page[data-print-page="cover"],
.print-page[data-print-page="back"]{
  position:relative!important; overflow:hidden!important; isolation:isolate;
  background:transparent!important; box-sizing:border-box!important;
  z-index:0;
}

/* 背景层（图片）隐藏 */
[data-print-page="cover"].print-page::before,
[data-print-page="back"].print-page::before,
[data-print-page="cover"].print-page::after,
[data-print-page="back"].print-page::after{
  display: none !important;
}

/* 内容层样式 */
.cover-page,.back-page{ 
  position:relative!important; 
  z-index:0!important; 
  display:flex!important; 
  flex-direction:column; 
  align-items:center; 
  justify-content:center;
  padding:0; 
  box-sizing:border-box; 
  color:#fff; 
  text-align:center;
}

/* 打印模式下封面和封底尺寸 */
@media print {
  .cover-page,.back-page{ 
    width:100%!important; 
    height:100vh!important;
  }
}

/* 浏览器预览模式下封面和封底尺寸 */
@media screen {
  .cover-page,.back-page{ 
    width:210mm!important; 
    height:297mm!important;
  }
}

/* ---------- html2pdf 导出：镜像打印规则 ---------- */
html.export-pdf{
  font-size:13px!important; -webkit-print-color-adjust:exact; print-color-adjust:exact; background:transparent!important;
}

/* 导出模式下封面和封底需要透明背景 - 使用更兼容的方法 */
html.export-pdf .print-only[data-print-page="cover"],
html.export-pdf .print-only[data-print-page="back"] {
  background: transparent !important;
}
html.export-pdf .print-only{ display:block!important; }
html.export-pdf .no-print{ display:none!important; }
html.export-pdf .no-print-only{ display:none!important; }

html.export-pdf .print-page{
  page-break-after:always; break-after:page;
  padding:12mm; box-sizing:border-box; background:white; width:210mm!important;
  min-height:calc(267mm - 24mm); /* A4高度减去页边距 */
}

/* 导出模式下最后一页不强制分页 */
html.export-pdf .print-page:last-child{
  page-break-after:auto; break-after:auto;
}

/* 导出模式下的分页控制 */
html.export-pdf .break-after-avoid{ page-break-after:avoid; break-after:avoid; }
html.export-pdf .break-inside-avoid-page{ page-break-inside:avoid; break-inside:avoid-page; }
html.export-pdf .space-y-2 > *:not(:first-child){ page-break-before:auto; }
html.export-pdf .space-y-3 > *:not(:first-child){ page-break-before:auto; }
html.export-pdf .space-y-4 > *:not(:first-child){ page-break-before:auto; }
html.export-pdf .space-y-6 > *:not(:first-child){ page-break-before:auto; }

/* 导出模式下的风险分析样式 */
html.export-pdf .print-risk-analysis {
  font-size: 12px !important;
  line-height: 1.4 !important;
}

html.export-pdf .print-risk-analysis h2 {
  font-size: 18px !important;
  font-weight: 700 !important;
  color: #1e40af !important;
  margin-bottom: 12px !important;
  page-break-after: avoid !important;
}

html.export-pdf .print-risk-analysis h3 {
  font-size: 16px !important;
  font-weight: 600 !important;
  color: #374151 !important;
  margin-bottom: 8px !important;
  page-break-after: avoid !important;
}

html.export-pdf .print-risk-analysis h4 {
  font-size: 14px !important;
  font-weight: 600 !important;
  margin-bottom: 6px !important;
  page-break-after: avoid !important;
}

/* 优化PDF中的风险和建议卡片样式 */
html.export-pdf .print-risk-analysis .bg-red-50 {
  background: #fef2f2 !important;
  border: 1px solid #fecaca !important;
}

html.export-pdf .print-risk-analysis .bg-blue-50 {
  background: #eff6ff !important;
  border: 1px solid #dbeafe !important;
}

html.export-pdf .print-risk-analysis .bg-red-600 {
  background: #dc2626 !important;
}

html.export-pdf .print-risk-analysis .bg-blue-600 {
  background: #2563eb !important;
}

html.export-pdf .print-risk-analysis .bg-gray-600 {
  background: #4b5563 !important;
}

/* 确保分页控制 */
html.export-pdf .page-break-inside-avoid {
  page-break-inside: avoid !important;
  break-inside: avoid !important;
}

html.export-pdf .print-risk-analysis .space-y-3 > * + * {
  margin-top: 8px !important;
}

html.export-pdf .print-risk-analysis .space-y-6 > * + * {
  margin-top: 16px !important;
}

html.export-pdf .print-risk-analysis .space-y-8 > * + * {
  margin-top: 20px !important;
}

/* 导出模式下封面和封底页面透明背景 */
html.export-pdf [data-print-page="cover"].print-page,
html.export-pdf [data-print-page="back"].print-page {
  background: transparent !important;
  display:block!important; position:relative; margin:0 auto!important;
  padding:0!important;
  min-height:297mm!important;
  height:297mm!important;
}
html.export-pdf .print-page[data-print-page="cover"],
html.export-pdf .print-page[data-print-page="back"]{
  padding:0!important; margin:0!important; border:0!important;
  width:100%!important; height:297mm!important; min-height:297mm!important;
  position:relative!important; overflow:hidden!important; isolation:isolate;
  background:transparent!important; box-sizing:border-box!important; z-index:0;
  top:0!important; left:0!important;
}
html.export-pdf [data-print-page="cover"].print-page::before,
html.export-pdf [data-print-page="back"].print-page::before{
  display: none !important;
}
/* 移除蒙版以确保PNG图片完整显示 */
html.export-pdf [data-print-page="cover"].print-page::after,
html.export-pdf [data-print-page="back"].print-page::after{
  display: none !important;
}
html.export-pdf .cover-page, html.export-pdf .back-page{ position:relative!important; z-index:0!important; }

/* —— 导出下的排版镜像 —— */
html.export-pdf .cover-page{
  display:grid!important; grid-template-rows:auto 1fr auto;
  padding:0mm; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
}
html.export-pdf .back-page{
  display:flex!important; flex-direction:column; align-items:center; justify-content:center;
  padding:0mm; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
}

/* ========================= */
/*           其他            */
/* ========================= */

@media print{
  html.print-mode{ font-size:13px!important; }
  html.print-mode *{ transform:none!important; animation:none!important; transition:none!important; box-shadow:none!important; filter:none!important; }
  html.print-mode .fixed,html.print-mode .sticky{ position:static!important; top:auto!important; inset:auto!important; }
  html.print-mode img,html.print-mode video,html.print-mode svg{ max-width:100%!important; height:auto!important; }
  html.print-mode table{ border-collapse:collapse!important; width:100%!important; }
  html.print-mode th,html.print-mode td{ page-break-inside:avoid!important; break-inside:avoid!important; }
  html.print-mode h1{ font-size:1.6rem!important; line-height:1.25!important; letter-spacing:.2px!important; }
  html.print-mode h2{ font-size:1.25rem!important; line-height:1.3!important; }
  html.print-mode h3{ font-size:1.05rem!important; line-height:1.35!important; }
  html.print-mode .prose :where(h1){ font-size:1.45rem!important; }
  html.print-mode .prose :where(h2){ font-size:1.2rem!important; }
  html.print-mode .prose :where(h3){ font-size:1.05rem!important; }
  html.print-mode a{ text-decoration:underline!important; color:#000!important; }
  .pdf-break-before{ page-break-before:always!important; }
  .pdf-break-after{ page-break-after:always!important; }
}

html.export-pdf *{ transform:none!important; animation:none!important; transition:none!important; box-shadow:none!important; filter:none!important; }
html.export-pdf .fixed,html.export-pdf .sticky{ position:static!important; top:auto!important; inset:auto!important; }
html.export-pdf img,html.export-pdf video,html.export-pdf svg{ max-width:100%!important; height:auto!important; }
html.export-pdf table{ border-collapse:collapse!important; width:100%!important; }
html.export-pdf th,html.export-pdf td{ page-break-inside:avoid!important; break-inside:avoid!important; }
html.export-pdf .prose :where(h1){ font-size:1.45rem!important; }
html.export-pdf .prose :where(h2){ font-size:1.2rem!important; }
html.export-pdf .prose :where(h3){ font-size:1.05rem!important; }
.exporting .no-print{ display:none!important; }
.exporting .no-print-only{ display:none!important; }
