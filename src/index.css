@tailwind base;
@tailwind components;
@tailwind utilities;

/* —— 基础主题 —— */
:root{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Noto Sans",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji";
  line-height:1.5; font-weight:400;
  font-synthesis:none; text-rendering:optimizeLegibility;
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}

/* —— 基础排版 —— */
@layer base{
  .prose p,.prose ul,.prose ol{ margin:1rem 0; line-height:1.5; }

  @media print{
    .no-print-only{ display:none!important; }
    .print-only{ display:block!important; }

    /* 内页边距：底部 20mm 为 52px 页脚留位 */
    @page{ size:A4 portrait; margin:12mm 12mm 20mm 12mm; }
    @page cover{ size:A4 portrait; margin:0; }
    @page back{  size:A4 portrait; margin:0; }

    html,body{
      background:#fff!important;
      -webkit-print-color-adjust:exact; print-color-adjust:exact;
      margin:0!important; padding:0!important; border:0!important;
    }
  }
}

/* —— 屏幕 & 打印通用卡片 —— */
.pdf-card{ border:1px solid rgba(0,0,0,.06); background:#fff; }
.pdf-card__logo img.pdf-logo{ max-height:96px; width:auto; }
.pdf-card__body .prose p{ margin:.5rem 0; }

@media print{
  [data-print-page="cover"]{ page:cover; }
  [data-print-page="back"]{  page:back;  }
  [data-print-page="cover"],[data-print-page="back"]{ break-inside:avoid; page-break-inside:avoid; }

  .pdf-card{ page-break-inside:avoid; break-inside:avoid; border-color:rgba(0,0,0,.1); }
  .pdf-card__logo img.pdf-logo{ max-height:80px; }
  .pdf-card__body .prose{ font-size:13px; line-height:1.5; }
}

/* ========================= */
/*     PDF 固定页脚（新版）    */
/* ========================= */

.fv-print-footer{ display:none; }
@media print{
  .fv-print-footer{
    position:fixed!important; left:0; right:0; bottom:0; height:52px;
    background:rgba(255,255,255,.98); border-top:1px solid rgba(0,0,0,.08);
    z-index:9999; transform:translateZ(0); will-change:transform;
    break-inside:avoid; page-break-inside:avoid;
  }
  .fv-print-footer .footer-inner{
    max-width:180mm; margin:0 auto; height:100%; padding:0 6mm; box-sizing:border-box;
    display:flex; align-items:center; justify-content:space-between;
  }
  .fv-print-footer .brand{ display:inline-flex; align-items:center; gap:16px; line-height:1; }
  .fv-print-footer .brand .sep{ width:1px; height:24px; background:rgba(0,0,0,.14); }
  .fv-print-footer .brand .logo{ display:block; max-height:30px; width:auto; object-fit:contain; filter:saturate(.95) contrast(1.03); }
  .fv-print-footer .page-number{ font-size:10px; color:rgba(0,0,0,.6); letter-spacing:.2px; white-space:nowrap; line-height:1; break-inside:avoid; page-break-inside:avoid; }
}

/* ===================================================== */
/*        打印专用「封面 / 尾页」容器基础                   */
/* ===================================================== */

.print-only{ display:none; }

/* —— 原生打印：满幅 + 出血 + 抗白边 —— */
@media print{
  .print-page{
    break-inside:avoid; page-break-inside:avoid; page-break-after:always;
    padding:12mm; box-sizing:border-box; background:#fff;
    width:210mm!important;
    min-height:calc(297mm - 12mm - 20mm - 12mm - 12mm);
    display:block!important; position:relative; margin:0 auto!important;
  }

  /* 封面和封底需要无padding以实现满版背景 */
  [data-print-page="cover"].print-page,
  [data-print-page="back"].print-page{
    padding:0!important;
  }

  [data-print-page="cover"].print-page,
  [data-print-page="back"].print-page{
    padding:0!important; width:100%!important; min-height:100vh!important; height:100vh!important;
    position:relative!important; overflow:hidden!important; isolation:isolate;
    background:transparent!important; margin:0!important;
    z-index:0;
  }

  /* 背景层（图片） - 调整为100% 100%以完全填满页面 */
  /* 注意：具体的背景图片在组件内联样式中设置 */
  [data-print-page="cover"].print-page::before,
  [data-print-page="back"].print-page::before{
    content:""; position:absolute; inset:0;
    background-position: center center;
    background-size: cover;
    background-repeat: no-repeat;
    z-index:0; -webkit-print-color-adjust:exact; print-color-adjust:exact;
    transform:none; transform-origin:center center;
    backface-visibility:hidden; will-change:transform;
    pointer-events:none;
  }

  /* 移除蒙版以确保PNG图片完整显示 */
  [data-print-page="cover"].print-page::after,
  [data-print-page="back"].print-page::after{
    display: none !important;
  }

  /* —— 内容层：始终可见 —— */
  .cover-page,.back-page{ position:relative!important; z-index:3!important; }

  /* —— 封面：三段式网格版式 —— */
  .cover-page{
    display:grid!important; grid-template-rows:auto 1fr auto;
    padding:0; box-sizing:border-box; width:210mm; height:297mm;
    color:#fff; /* 蒙层下默认白字可读，如需深字可覆盖 */
    text-align:center;
  }
  .cover-brand{
    display:flex; align-items:center; justify-content:space-between; gap:8mm;
    margin:18mm 18mm 0 18mm;
  }
  .cover-brand .logo{ max-height:20mm; width:auto; object-fit:contain; display:block; filter:drop-shadow(0 0 0 rgba(0,0,0,0)); }
  .cover-titleblock{
    align-self:center; justify-self:center; max-width:160mm; margin:0 auto;
    padding:0 18mm;
  }
  .cover-title{ font-size:30px; line-height:1.2; font-weight:800; letter-spacing:.2px; margin-bottom:6mm; }
  .cover-sub{ font-size:14px; opacity:.95; margin-bottom:3mm; }
  .cover-date{ font-size:12px; opacity:.9; }
  .cover-meta{
    align-self:end; display:flex; gap:10mm; justify-content:center; flex-wrap:wrap; font-size:11px; opacity:.95;
    margin:0 18mm 18mm 18mm;
  }

  /* —— 尾页：信息居中 + 二维码 —— */
  .back-page{
    display:flex!important; flex-direction:column; align-items:center; justify-content:center;
    padding:0; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
  }
  .back-title{ font-size:20px; font-weight:700; margin-bottom:6mm; padding:0 16mm; }
  .back-lines{ font-size:12px; line-height:1.6; opacity:.95; padding:0 16mm; }
  .back-qr{ margin-top:10mm; }
  .back-qr img{ width:38mm; height:38mm; object-fit:contain; display:block; background:#fff; padding:2mm; border-radius:2mm; }
  .back-qr p{ font-size:10px; opacity:.9; margin-top:3mm; }
  .back-copy{ position:absolute; left:16mm; right:16mm; bottom:18mm; font-size:10px; opacity:.9; }
}

/* ---------- html2pdf 导出：镜像打印规则 ---------- */
html.export-pdf{
  font-size:13px!important; -webkit-print-color-adjust:exact; print-color-adjust:exact; background:#fff!important;
}
html.export-pdf .print-only{ display:block!important; }
html.export-pdf .no-print-only{ display:none!important; }

html.export-pdf .print-page{
  break-inside:avoid; page-break-inside:avoid; page-break-after:always;
  padding:12mm; box-sizing:border-box; background:#fff; width:210mm!important;
  min-height:calc(297mm - 12mm - 20mm - 12mm - 12mm);
  display:block!important; position:relative; margin:0 auto!important;
}
html.export-pdf [data-print-page="cover"].print-page,
html.export-pdf [data-print-page="back"].print-page{
  padding:0!important; width:100%!important; min-height:100vh!important; height:100vh!important;
  position:relative!important; overflow:hidden!important; isolation:isolate;
  background:transparent!important; margin:0!important; z-index:0;
}
html.export-pdf [data-print-page="cover"].print-page::before,
html.export-pdf [data-print-page="back"].print-page::before{
  content:""; position:absolute; inset:0;
  background:var(--bg-image, none) center center / cover no-repeat;
  z-index:0; -webkit-print-color-adjust:exact; print-color-adjust:exact;
  transform:none; transform-origin:center center;
  backface-visibility:hidden; will-change:transform; pointer-events:none;
}
/* 移除蒙版以确保PNG图片完整显示 */
html.export-pdf [data-print-page="cover"].print-page::after,
html.export-pdf [data-print-page="back"].print-page::after{
  display: none !important;
}
html.export-pdf .cover-page, html.export-pdf .back-page{ position:relative!important; z-index:3!important; }

/* —— 导出下的排版镜像 —— */
html.export-pdf .cover-page{
  display:grid!important; grid-template-rows:auto 1fr auto;
  padding:18mm; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
}
html.export-pdf .cover-brand{ display:flex; align-items:center; justify-content:space-between; gap:8mm; }
html.export-pdf .cover-brand .logo{ max-height:20mm; width:auto; object-fit:contain; display:block; }
html.export-pdf .cover-titleblock{ align-self:center; justify-self:center; max-width:160mm; margin:0 auto; }
html.export-pdf .cover-title{ font-size:30px; line-height:1.2; font-weight:800; letter-spacing:.2px; margin-bottom:6mm; }
html.export-pdf .cover-sub{ font-size:14px; opacity:.95; margin-bottom:3mm; }
html.export-pdf .cover-date{ font-size:12px; opacity:.9; }
html.export-pdf .cover-meta{ align-self:end; display:flex; gap:10mm; justify-content:center; flex-wrap:wrap; font-size:11px; opacity:.95; }

html.export-pdf .back-page{
  display:flex!important; flex-direction:column; align-items:center; justify-content:center;
  padding:16mm; box-sizing:border-box; width:210mm; height:297mm; color:#fff; text-align:center;
}
html.export-pdf .back-title{ font-size:20px; font-weight:700; margin-bottom:6mm; }
html.export-pdf .back-lines{ font-size:12px; line-height:1.6; opacity:.95; }
html.export-pdf .back-qr{ margin-top:10mm; }
html.export-pdf .back-qr img{ width:38mm; height:38mm; object-fit:contain; display:block; background:#fff; padding:2mm; border-radius:2mm; }
html.export-pdf .back-qr p{ font-size:10px; opacity:.9; margin-top:3mm; }
html.export-pdf .back-copy{ position:absolute; left:0; right:0; bottom:18mm; font-size:10px; opacity:.9; }

/* ========================= */
/*           其他            */
/* ========================= */

@media print{
  html.print-mode{ font-size:13px!important; }
  html.print-mode *{ transform:none!important; animation:none!important; transition:none!important; box-shadow:none!important; filter:none!important; }
  html.print-mode .fixed,html.print-mode .sticky{ position:static!important; top:auto!important; inset:auto!important; }
  html.print-mode img,html.print-mode video,html.print-mode svg{ max-width:100%!important; height:auto!important; }
  html.print-mode table{ border-collapse:collapse!important; width:100%!important; }
  html.print-mode th,html.print-mode td{ page-break-inside:avoid!important; break-inside:avoid!important; }
  html.print-mode h1{ font-size:1.6rem!important; line-height:1.25!important; letter-spacing:.2px!important; }
  html.print-mode h2{ font-size:1.25rem!important; line-height:1.3!important; }
  html.print-mode h3{ font-size:1.05rem!important; line-height:1.35!important; }
  html.print-mode .prose :where(h1){ font-size:1.45rem!important; }
  html.print-mode .prose :where(h2){ font-size:1.2rem!important; }
  html.print-mode .prose :where(h3){ font-size:1.05rem!important; }
  html.print-mode a{ text-decoration:underline!important; color:#000!important; }
  .pdf-break-before{ page-break-before:always!important; }
  .pdf-break-after{ page-break-after:always!important; }
}

html.export-pdf *{ transform:none!important; animation:none!important; transition:none!important; box-shadow:none!important; filter:none!important; }
html.export-pdf .fixed,html.export-pdf .sticky{ position:static!important; top:auto!important; inset:auto!important; }
html.export-pdf img,html.export-pdf video,html.export-pdf svg{ max-width:100%!important; height:auto!important; }
html.export-pdf table{ border-collapse:collapse!important; width:100%!important; }
html.export-pdf th,html.export-pdf td{ page-break-inside:avoid!important; break-inside:avoid!important; }
html.export-pdf .prose :where(h1){ font-size:1.45rem!important; }
html.export-pdf .prose :where(h2){ font-size:1.2rem!important; }
html.export-pdf .prose :where(h3){ font-size:1.05rem!important; }
.exporting .no-print-only{ display:none!important; }
