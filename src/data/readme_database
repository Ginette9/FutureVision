# CSR数据库设计文档


## 数据库结构

### 1. 内容表（5个）

#### 1.1 risks（风险表）
```sql
CREATE TABLE risks (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    issue TEXT,                 -- 议题
    sub_issue TEXT,             -- 子议题
    content TEXT,               -- 风险内容
    source TEXT,                -- 来源
    file_name TEXT,             -- 源文件名
    classification TEXT,        -- 分类：specific/country/industry/general
    UNIQUE(issue, sub_issue, content)
);
```

#### 1.2 advice（建议表）
```sql
CREATE TABLE advice (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    issue TEXT,                 -- 议题
    sub_issue TEXT,             -- 子议题
    content TEXT,               -- 建议内容
    source TEXT,                -- 来源
    file_name TEXT,             -- 源文件名
    classification TEXT,        -- 分类
    UNIQUE(issue, sub_issue, content)
);
```

#### 1.3 considerations（重要考虑事项表）
```sql
CREATE TABLE considerations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    content TEXT,               -- 考虑事项内容
    source TEXT,                -- 来源
    file_name TEXT,             -- 源文件名
    classification TEXT,        -- 分类
    UNIQUE(content)
);
```

#### 1.4 organizations（组织表）
```sql
CREATE TABLE organizations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,                  -- 组织名称
    logo TEXT,                  -- 标志
    intro TEXT,                 -- 介绍
    link TEXT,                  -- 链接
    source TEXT,                -- 来源
    file_name TEXT,             -- 源文件名
    classification TEXT,        -- 分类
    UNIQUE(name, intro)
);
```

#### 1.5 initiatives（倡议表）
```sql
CREATE TABLE initiatives (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT,                  -- 倡议名称
    logo TEXT,                  -- 标志
    intro TEXT,                 -- 介绍
    link TEXT,                  -- 链接
    source TEXT,                -- 来源
    file_name TEXT,             -- 源文件名
    classification TEXT,        -- 分类
    UNIQUE(name, intro)
);
```

### 2. 核心优化表

#### 2.1 applicability_grouped（分组适用范围表）
```sql
CREATE TABLE applicability_grouped (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    country TEXT,               -- 国家
    industry TEXT,              -- 行业
    risk_ids TEXT,              -- 风险ID列表，逗号分隔，如"1,5,23,67"
    advice_ids TEXT,            -- 建议ID列表，逗号分隔，如"2,8,15"
    consideration_ids TEXT,      -- 考虑事项ID列表，逗号分隔，如"3,9"
    organization_ids TEXT,       -- 组织ID列表，逗号分隔，如"4,12,45"
    initiative_ids TEXT,        -- 倡议ID列表，逗号分隔，如"7,19,33"
    total_content_count INTEGER, -- 该组合下的总内容数
    UNIQUE(country, industry)
);
```

**关键特点：**
- 每个国家+行业组合一条记录
- 存储该组合下所有适用的五类内容ID
- 大幅压缩存储空间

### 3. 辅助表

#### 3.1 issues（议题表）
```sql
CREATE TABLE issues (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    issue_name TEXT UNIQUE      -- 议题名称
);
```

#### 3.2 sub_issues（子议题表）
```sql
CREATE TABLE sub_issues (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    sub_issue_name TEXT,        -- 子议题名称
    parent_issue_id INTEGER,    -- 父议题ID
    FOREIGN KEY (parent_issue_id) REFERENCES issues (id)
);
```
